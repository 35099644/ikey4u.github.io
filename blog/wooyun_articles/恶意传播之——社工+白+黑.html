
        <html>
			<head>
			     <title>恶意传播之——社工+白+黑 - 卫士通攻防实验室</title>
				 <meta http-equiv="content-type" content="text/html; charset=UTF-8">
			</head>
			<body>
				<h1>原文地址:<a href="http://drops.wooyun.org/tips/16279">http://drops.wooyun.org/tips/16279</a></h1>
				
      <p>
        <h1>0x00 背景</h1>

<hr />

<p>日前实验室捕获一个样本。远远望去，像是搜狗输入法，在测试机中点开一看，弹出一款游戏的物价表，再看PE文件属性，还带正常着数字签名，一副人畜无害的样子。经过一番认真分析后。发现远没有这么简单，这里就分析过程记录一下，希望其他安全工作者有些许帮助。</p>

<p>先介绍一下所谓白名单免杀。随着病毒与杀软之间的斗争，杀软的手段不断地增多、增强，由早期传统的特征码匹配算法发展到目前虚拟机技术、实时监控技术等流行的查杀算法。但始终存在一种最直接也最根本的免杀方式——白名单免杀。病毒就安安静静地躺在杀软的白名单中，谁闲的没事会去查水表呢？</p>

<!--more-->

<p>当了解了白名单免杀的基本含义之后，就可以针对样本进行深入的研究，本文以下内容就是笔者拿到样本之后，逐步分析样本主要功能的完整过程，其分析环境如下：</p>

<ul>
<li>分析环境：win 7 x86 VMware </li>
<li>分析工具：IDA、CFF、OD</li>
</ul>

<h1>0x01 样本概述</h1>

<hr />

<p>样本包含5个文件：</p>

<table>
<thead>
<tr>
  <th>File name</th>
  <th>size</th>
  <th>MD5</th>
  <th>attribute</th>
</tr>
</thead>
<tbody>
<tr>
  <td>nvvsvc1.exe.exe</td>
  <td>451.50 KB (462336 bytes)</td>
  <td>4D9B3A508BC2402A86E10F7907022263</td>
  <td>hidden</td>
</tr>
<tr>
  <td>HWSignature.dll</td>
  <td>48.50 KB (49664 bytes)</td>
  <td>85F50E1D2DE076079D98F09416E4C710</td>
  <td>hidden</td>
</tr>
<tr>
  <td>HanziSort.dat</td>
  <td>158.75 KB (162557 bytes)</td>
  <td>4FB42CBC7ADD3CF2AB3F0A99B9E7CE25</td>
  <td>hidden</td>
</tr>
<tr>
  <td>图1</td>
  <td>Shortcut linked to cmd</td>
  <td>cmd /c nvvsvc1.exe &amp; exit</td>
  <td>Shortcut</td>
</tr>
<tr>
  <td>01.jpg.jpg</td>
  <td>99.07 KB (101446 bytes)</td>
  <td>78501660AD39494A7248BA0C96989494</td>
  <td>hidden</td>
</tr>
</tbody>
</table>

<ul>
<li>nvvsvc1.exe：即为搜狗输入法的更新工具，用virusbook查看后可判定完全没有问题。此外，该文件有正常的数字签名，见下图。</li>
</ul>

<p><img src="https://github.com/ikey4u/WooyunImages/raw/master/pics/f26c661588aca643c694de940bcf67cc.jpg" alt="p1" /></p>

<ul>
<li>HWSignature.dll：这个DLL原本是搜狗输入法的硬件签名DLL，该样本中被劫持为恶意劫持。</li>
<li>HanziSort.dat：原本为搜狗输入法与汉字相关的数据文件，该样本中被替换为其他数据文件。</li>
<li>01.jpg.jpg：一副jpg图片，内容为《怪物猎人官方最新价格表》，后文有展示。</li>
<li>图1：指向cmd的快捷方式，其参数为<code>cmd.exe /c nvvsvc1.exe &amp; exit</code></li>
</ul>

<p>其中，nvvsvc1.exe为主程序，其目的是加载HWSignature.dll，而HWSignature.dll会加载并解码HanziSort.dat， 进一步的，HanziSort.dat会再次解码自身并在内存中释放svchost2.dll，此后手动加载svchost2.dll，该DLL为包含恶意程序的主要功能。</p>

<p>传播方式：以《怪物猎人官方最新物价表》为鱼饵进行钓鱼，下载解压后，其他文件隐藏，只能看到名称为“图1”的文件，点开后确实会展示图片，但木马也会加载。<strong>笔者建议广大游戏玩家，下载的攻略要先看清是什么东西，再点开查看内容。</strong></p>

<h1>0x02 主程序分析</h1>

<hr />

<p>拿到样本之后，首先放到virusbook查了查，主程序想必没问题，而除此之外的一个DLL就被查出有问题了。很明显，这是一个通过DLL劫持加载自己的木马样本，这种通过DLL劫持的木马，可以算是白名单免杀吗？这个问题先放一放，后文（0x8 结语）会给出笔者的看法。</p>

<p>IDA分析主程序，绝大部分都是输入法相关的操作，中规中矩。值得注意的是，此处创建了8个线程。</p>

<p><img src="https://github.com/ikey4u/WooyunImages/raw/master/pics/42cdfc9a54e6523c77f1d5045f8f7008.jpg" alt="p2" /></p>

<p>这其中第4个线程，即执行sub&#95;427C80的线程会进一步调用sub&#95;42F090函数，在该函数的子函数中，会加载HWSignature.dll，但此处被样本劫持，用来执行其恶意功能。</p>

<p><img src="https://github.com/ikey4u/WooyunImages/raw/master/pics/122c8ac844d3f975d1380586e8438310.jpg" alt="p3" /></p>

<h1>0x03 DLL分析</h1>

<hr />

<p>跟进这个DLL，进一步分析该DLL的行为。无关行为不说，该DLL会打开HanziSort.dat文件：</p>

<p><img src="https://github.com/ikey4u/WooyunImages/raw/master/pics/d59bbe6ce18856ac1a78e74417bda28d.jpg" alt="p4" /></p>

<p>读取其内容，并解码：</p>

<p><img src="https://github.com/ikey4u/WooyunImages/raw/master/pics/a3469fcc07bf65595a1451de3e8cba90.jpg" alt="p5" /></p>

<p>其解码方式很简单，只是把读取到的文件内容逐字节的与0x56做异或运算。解码之后，成为包含可执行指令的程序段：</p>

<p><img src="https://github.com/ikey4u/WooyunImages/raw/master/pics/c55d377e4044907c4320dae0f22f5a07.jpg" alt="p6" /></p>

<p>此后，程序会通过retn的方式跳到解码的代码段执行。</p>

<h1>0x04 DAT分析</h1>

<hr />

<p>在DAT解码的代码中，首先会寻找解码内容为0xDDCCBBAA的位置：</p>

<p><img src="https://github.com/ikey4u/WooyunImages/raw/master/pics/6ab0cfaa4c9fe5f32c4d183f39be6419.jpg" alt="p7" /></p>

<p>通过该地址，可以辅助完成一些列的定位操作，具体内容不做介绍。进而会调用VirtualAlloc函数分配内存空间，然后通过memcpy函数将指定数据拷贝到申请的内存中：</p>

<p><img src="https://github.com/ikey4u/WooyunImages/raw/master/pics/bb3567d20f009bd94ae840c034935a7a.jpg" alt="p8" /></p>

<p><img src="https://github.com/ikey4u/WooyunImages/raw/master/pics/17e2fa9286bbd68c99bf119fb1a961c3.jpg" alt="p9" /></p>

<p>而拷贝过去的内存段，会再一次进行解码：</p>

<p><img src="https://github.com/ikey4u/WooyunImages/raw/master/pics/8bbae440fe04e35c4fc80cd5adc23109.jpg" alt="p10" /></p>

<p>其解码方式同样比较简单，是逐字节与0xCC进行异或运算。当完整所有解码工作之后，可以发现解码之后的内存为一个完整的PE文件：</p>

<p><img src="https://github.com/ikey4u/WooyunImages/raw/master/pics/196aaa622f941bc54d4d4a4b69facecc.jpg" alt="p11" /></p>

<p>将该PE文件dump出来，用查看CFF看下，可以确认是个完整的DLL：</p>

<p><img src="https://github.com/ikey4u/WooyunImages/raw/master/pics/cf0dbe4a2e7d0028352fa272ee60b11f.jpg" alt="p12" /> <em>(忽略一些细节吧。笔者懒得打码了。)</em></p>

<p>这个DLL叫做svchost2.dll，后面的代码可想而知，新申请一块内存</p>

<p><img src="https://github.com/ikey4u/WooyunImages/raw/master/pics/34f52a1024c1da9b0da2258bfdfb789b.jpg" alt="p13" /></p>

<p>然后手动完成PE的加载流程：</p>

<p><img src="https://github.com/ikey4u/WooyunImages/raw/master/pics/485c99bb665091e82b99b9bdf4495a89.jpg" alt="p14" /></p>

<p>以及根据导入表和重定位表做一些修复工作，并加载所需的各种DLL，最后调用VirtualProtect更改页保护。</p>

<p><img src="https://github.com/ikey4u/WooyunImages/raw/master/pics/7ee1ee986aa93a0e70633942701cfe5a.jpg" alt="p15" /></p>

<p>完成以上操作之后，调用DLL main函数：</p>

<p><img src="https://github.com/ikey4u/WooyunImages/raw/master/pics/64cf38be4814d72cd1f9916aaea0ab63.jpg" alt="p16" /></p>

<p>DLL的主函数并没有什么需要深入分析的地方，这里略过。DLL main返回后，会查找DLL导出的mystart函数：</p>

<p><img src="https://github.com/ikey4u/WooyunImages/raw/master/pics/750ade6dc12db67a0f26c2ab0842b2e2.jpg" alt="p17" /></p>

<p>最后调用mystart：</p>

<p><img src="https://github.com/ikey4u/WooyunImages/raw/master/pics/2bddfa532ba2744b6a879e4af828c703.jpg" alt="p18" /></p>

<h1>0x05 mystart分析</h1>

<hr />

<p>在该函数中，首先会获得当前仅进程的名字，并判断名字中是否包含”1.exe”字符串。</p>

<p><img src="https://github.com/ikey4u/WooyunImages/raw/master/pics/a33794b8ace2f574d5f9911bf5139c75.jpg" alt="p19" /></p>

<p>获得的样本中，当然是包含该字符串的。接下来，会进行一些有意思的事。首先会调用WinExec执行”<code>taskkill /f /im cmd.exe</code>”命令，然后创建一个互斥体。</p>

<p><img src="https://github.com/ikey4u/WooyunImages/raw/master/pics/98765a759c6806036dca137bd046aa6c.jpg" alt="p20" /></p>

<p>进一步的，该样本会在C:\Users\zzz\AppData\Roaming创建一个文件夹，其名字随机：</p>

<p><img src="https://github.com/ikey4u/WooyunImages/raw/master/pics/c0733280e0af26d882ca516c3adece5d.jpg" alt="p21" /></p>

<p>在本次分析中为：C:\Users\zzz\AppData\Roaming\dptpbzwoztxwrh，并将样本所在的文件夹中所有文件都复制到该目录下，包括ida生成的几个文件，但排除01.jpg.jpg。对于这幅图片，该样本会调用cmd执行rundll32.exe shimgvw.dll imageview_fullscreen 01.jpg.jpg，其作用就是把样本中的01.jpg.jpg展示出来：</p>

<p><img src="https://github.com/ikey4u/WooyunImages/raw/master/pics/7f1e8265791a1faa084966d819e436eb.jpg" alt="p22" /> <em>（01.jpg.jpg ：什么仇什么怨？）</em></p>

<p>如此一来，受害者看到了想了解的《价格表》，也不会怀疑该文件是木马了。此外，复制到Roaming的主程序会重命名为MSUpdateXXXXXXXX.exe，XXXXXXXX表示8位随机字母。注意，IDA生成的几个文件也会被复制过去并重命名。</p>

<p><img src="https://github.com/ikey4u/WooyunImages/raw/master/pics/1b6ad6cf816b5ffd2f978815840201cb.jpg" alt="p23" /></p>

<p>拷贝完成之后，释放互斥体，并Sleep(0x2EE0)的时间。</p>

<p><img src="https://github.com/ikey4u/WooyunImages/raw/master/pics/6cca8eb000387441f90f5dd0cef0e446.jpg" alt="p24" /></p>

<p>并注册表增加一些键值：</p>

<p><img src="https://github.com/ikey4u/WooyunImages/raw/master/pics/61ff4728aa303cb10eaad061028b5f13.jpg" alt="p25" /></p>

<p>最后，通过shellexecute执行刚刚复制到Roaming的样本文件。</p>

<p><img src="https://github.com/ikey4u/WooyunImages/raw/master/pics/a4e20769c1c5801f87331c0538ec6f0e.jpg" alt="p26" /></p>

<h1>0x06 第二次执行分析</h1>

<hr />

<p>当第二次执行时，之前的行为都是类似的，只有在mystart函数中，出现了变化。由于当前进程是复制到Roaming下的镜像文件，重命名之后不包含”1.exe”字符串（参考上文）。所以会执行到另一个分支，调用Fi函数。</p>

<p><img src="https://github.com/ikey4u/WooyunImages/raw/master/pics/f8140a57c1af8cb03150a55badb79357.jpg" alt="p27" /></p>

<p>该函数为svchost2.dll的另外一个导出函数。该函数会隐藏自己的进程名以及其他的信息：</p>

<p><img src="https://github.com/ikey4u/WooyunImages/raw/master/pics/0a46fa5cfb3af8c97843eb3100d66cf2.jpg" alt="p28" /></p>

<p>隐藏结果使自己的进程名变为csrss.exe的，如图：</p>

<p><img src="https://github.com/ikey4u/WooyunImages/raw/master/pics/7892c2931954abf5f3445bbbf2eaca3c.jpg" alt="p29" /></p>

<p>但这种隐藏手段并不高级，随便一个工具就能识别出来。</p>

<p>进而，会调用Fa函数，该DLL的另一个导出函数。在该函数中出现了一些网络行为。首先，会连接139.196.184.116:34176</p>

<p><img src="https://github.com/ikey4u/WooyunImages/raw/master/pics/b7641484614d7bf9492cfc3373de1a0f.jpg" alt="p30" /></p>

<p>并发送数据：</p>

<p><img src="https://github.com/ikey4u/WooyunImages/raw/master/pics/9ad90360bf7d112137105bb2a311ad71.jpg" alt="p31" /></p>

<p>该数据是怎么来的，暂时没有必要追究。有需要时，可以进一步分析，不过，可以肯定的是，对于同一台机器，每次发送的数据是一样的，应该是作为机器的ID标识。发送之后，会接收到如下内容：</p>

<p><img src="https://github.com/ikey4u/WooyunImages/raw/master/pics/48c93003b9819188aaee05e2e0dac604.jpg" alt="p32" /></p>

<p>针对返回的内容，会判断是否含有”Set-Cookie:”字符串，如果有，则取出：</p>

<p><img src="https://github.com/ikey4u/WooyunImages/raw/master/pics/26f688f24e1aef76669d5decc6e51922.jpg" alt="p33" /></p>

<p>接下来，会用该Cookie作为机器的标识。</p>

<p>进而，会连接139.196.184.116:35131地址：</p>

<p><img src="https://github.com/ikey4u/WooyunImages/raw/master/pics/c6dfd0c25b5e2aa359548f68234c4def.jpg" alt="p34" /></p>

<p>但是该端口已经挂掉了，无法连接上。所以，笔者只好重新定向到自己的IP，并模拟其通信。 连接上IP之后，会发送一些随机生成的数据：</p>

<p><img src="https://github.com/ikey4u/WooyunImages/raw/master/pics/bd7bcc02974de599309369f260360524.jpg" alt="p35" /></p>

<p>本机的监听结果如下：</p>

<p><img src="https://github.com/ikey4u/WooyunImages/raw/master/pics/41633da3ead3ef5c749da400ac2a23f1.jpg" alt="p36" /></p>

<p>发送3次随机生成的数据之后，会创建新线程用于接收返回数据：</p>

<p><img src="https://github.com/ikey4u/WooyunImages/raw/master/pics/1def5c6450deb417e4fd096f60369a04.jpg" alt="p37" /></p>

<p>该线程会接收来自139.196.184.116:35131回复的数据，但是由于该端口已经挂掉了，笔者只能随意的回复点什么东西，<a class="__cf_email__" href="/cdn-cgi/l/email-protection" data-cfemail="896f261d6c2f0b61263dc8cdc5e8ebc9feecfafde6e7eca7eae6e4a7eae7">[email&#160;protected]</a><script data-cfhash='f9e31' type="text/javascript">/* <![CDATA[ */!function(t,e,r,n,c,a,p){try{t=document.currentScript||function(){for(t=document.getElementsByTagName('script'),e=t.length;e--;)if(t[e].getAttribute('data-cfhash'))return t[e]}();if(t&&(c=t.previousSibling)){p=t.parentNode;if(a=c.getAttribute('data-cfemail')){for(e='',r='0x'+a.substr(0,2)|0,n=2;a.length-n;n+=2)e+='%'+('0'+('0x'+a.substr(n,2)^r).toString(16)).slice(-2);p.replaceChild(document.createTextNode(decodeURIComponent(e)),c)}p.removeChild(t)}}catch(u){}}()/* ]]> */</script></p>

<p><img src="https://github.com/ikey4u/WooyunImages/raw/master/pics/685e90a27f1008360141e72c75519d26.jpg" alt="p38" /></p>

<p>接收到回复之后，会在sub_12A50F0中做解码工作。其解码工作首先会将受到的数据逐比特与0xE9异或。</p>

<p><img src="https://github.com/ikey4u/WooyunImages/raw/master/pics/2415b25294be59afc6c14dc34b599621.jpg" alt="p39" /></p>

<p>进而会对长度进行判断，然后对几个关键位置的内容进行判断，如果出现不符合的情况就会结束该线程；如果全部满足条件，则调用zlib 1.2.8版的库函数解压接收到的数据。</p>

<p><img src="https://github.com/ikey4u/WooyunImages/raw/master/pics/a403297dd2f4aa37eb4db314012bc101.jpg" alt="p40" /></p>

<p>最后根据解压缩出来的内容选择初始化某个对象，并调用该对象的成员函数，实现恶意功能。</p>

<p><img src="https://github.com/ikey4u/WooyunImages/raw/master/pics/02393d47c81dde76b16326181293bde5.jpg" alt="p41" /></p>

<p>执行完毕后，该线程会进入循环接收新的数据，并执行相应功能。此外，主线程创建了上述之后，会统计当前系统的各种信息：</p>

<p><img src="https://github.com/ikey4u/WooyunImages/raw/master/pics/7d719c66cd917158445d82987f6fe015.jpg" alt="p42" /></p>

<p>其中sub_100010F0实现捕获摄像头信息的相关操作。当获取了所有的信息之后，发送给目标地址，目标地址同样挂掉了。最后同样进入发送和接收的循环中。</p>

<h1>0x07 恶意功能分析</h1>

<hr />

<p>该样本的恶意功能比较多，现随机展示一个通过匿名双管道实现远程CMD的功能。该功能由编号0x31的分支实现。</p>

<p><img src="https://github.com/ikey4u/WooyunImages/raw/master/pics/f4d1e76c6ccc80f5c04abf949652bfee.jpg" alt="p43" /></p>

<p>详情参考sub&#95;10007DC0函数，该函数首先会调用sub&#95;10004C00 初始化socket，进而调用sub_1000F060创建管道并启动CMD进程：</p>

<p><img src="https://github.com/ikey4u/WooyunImages/raw/master/pics/dbd618c0a19dec848770864d54c6d98f.jpg" alt="p44" /></p>

<p><img src="https://github.com/ikey4u/WooyunImages/raw/master/pics/0d750e160254cf2dde93a44ab451cb3c.jpg" alt="p45" /></p>

<!--这里文档显示不正确,留空-->

<!--![p46][46]-->

<h1>0x08 结语</h1>

<hr />

<p>这个样本并不复杂，但是能够实现较为全面的木马功能，另外通过游戏攻略进行传播，利用白+黑的方式过杀软。哪怕现在HWSignature.dll会被查杀。但有白名单宿主进程的话，绕过杀软并不困难（基本瞬间就能想到好几种绕过检测的方式）。因此这种模式是值得我们警惕的。</p>      </p>
    
			</body>
		</html>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          